---
import { localize, type Lang, type L10n } from "../i18n";
import CTAButton from "./CTAButton.astro";

interface PricingOption {
    label: L10n;
    href: string;
    external?: boolean;
    note?: L10n;
}

interface DienstData {
    checkoutUrl: string;
    hero: { primaryCtaLabel: L10n };
    benefits: {
        items: readonly L10n[];
    };
    pricing: {
        title: L10n;
        priceText: L10n;
        metaLines: readonly L10n[];
        options?: readonly PricingOption[];
    };
}

interface Props {
    dienst: DienstData;
    lang: Lang;
    keyBase: string;
}

const { dienst, lang, keyBase } = Astro.props as Props;
---

<aside class="rounded-2xl border border-main/35 bg-main-soft px-5 py-6">
    <p class="text-xs font-semibold uppercase tracking-wide text-detail">
        <span data-i18n={`${keyBase}.pricing.title`}>
            {localize(dienst.pricing.title, lang)}
        </span>
    </p>
    <p class="mt-2 text-3xl font-extrabold text-secondary">
        <span data-i18n={`${keyBase}.pricing.priceText`}>
            {localize(dienst.pricing.priceText, lang)}
        </span>
    </p>

    <ul class="mt-3 space-y-1">
        {
            dienst.pricing.metaLines.map((line, index) => (
                <li class="text-sm text-text">
                    <span data-i18n={`${keyBase}.pricing.metaLines.${index}`}>
                        {localize(line, lang)}
                    </span>
                </li>
            ))
        }
    </ul>

    {
        dienst.benefits.items.length > 0 && (
            <ul class="mt-4 space-y-2 border-t border-secondary/15 pt-4">
                {dienst.benefits.items.map((line, index) => (
                    <li class="flex items-start gap-3 text-sm text-text">
                        <span
                            class="mt-0.5 inline-flex h-5 w-5 shrink-0 items-center justify-center rounded-full border border-secondary/35 text-secondary"
                            aria-hidden="true"
                        >
                            <svg
                                viewBox="0 0 20 20"
                                fill="none"
                                class="h-3.5 w-3.5"
                            >
                                <path
                                    d="M5 10.5L8.2 13.7L15 6.9"
                                    stroke="currentColor"
                                    stroke-width="2"
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                />
                            </svg>
                        </span>
                        <span data-i18n={`${keyBase}.benefits.items.${index}`}>
                            {localize(line, lang)}
                        </span>
                    </li>
                ))}
            </ul>
        )
    }

    <div class="mt-5 space-y-3">
        {
            dienst.pricing.options && dienst.pricing.options.length > 0 ? (
                dienst.pricing.options.map((option, index) => (
                    <div class="space-y-1.5">
                        <CTAButton
                            href={option.href}
                            target={
                                option.external === true ? "_blank" : undefined
                            }
                            rel={
                                option.external === true
                                    ? "noopener noreferrer"
                                    : undefined
                            }
                            variant={index === 0 ? "primary" : "secondary"}
                            label={localize(option.label, lang)}
                            labelKey={`${keyBase}.pricing.options.${index}.label`}
                        />
                        {option.note && (
                            <p class="text-sm text-text">
                                <span
                                    data-i18n={`${keyBase}.pricing.options.${index}.note`}
                                >
                                    {localize(option.note, lang)}
                                </span>
                            </p>
                        )}
                    </div>
                ))
            ) : (
                <CTAButton
                    href={dienst.checkoutUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                    variant="primary"
                    label={localize(dienst.hero.primaryCtaLabel, lang)}
                    labelKey={`${keyBase}.hero.primaryCtaLabel`}
                />
            )
        }
    </div>
</aside>
