---
import BaseLayout from "../layouts/BaseLayout.astro";
import CTASection from "./CTASection.astro";
import PricingSidebar from "./PricingSidebar.astro";
import Section from "./Section.astro";
import { localize, resolveLangFromUrl, type L10n } from "../i18n";

interface DienstSection {
    title: L10n;
    body: L10n;
    bullets?: L10n[];
}

interface DienstData {
    slug: string;
    seo: {
        title: L10n;
        description: L10n;
    };
    header: {
        title: L10n;
        subtitle: L10n;
    };
    content: {
        intro: L10n;
        sections: DienstSection[];
    };
    pricing: {
        currencyLabel: L10n;
        priceLabel: L10n;
        items: Array<{
            name: L10n;
            priceText: L10n;
            durationText?: L10n;
            notes?: L10n[];
        }>;
    };
    ctas: Array<{
        label: L10n;
        href: string;
        external?: boolean;
    }>;
}

interface Props {
    dienst: DienstData;
    keyBase: string;
}

const { dienst, keyBase } = Astro.props as Props;
const lang = resolveLangFromUrl(Astro.url);
const primaryCta = dienst.ctas[0];
const secondaryCta = dienst.ctas[1];
---

<BaseLayout
    title={localize(dienst.seo.title, lang)}
    description={localize(dienst.seo.description, lang)}
>
    <Section variant="hero">
        <div class="max-w-3xl">
            <h1 class="text-4xl font-extrabold leading-tight text-secondary md:text-5xl">
                <span data-i18n={`${keyBase}.dienst.header.title`}>
                    {localize(dienst.header.title, lang)}
                </span>
            </h1>
            <p class="mt-4 text-lg text-text">
                <span data-i18n={`${keyBase}.dienst.header.subtitle`}>
                    {localize(dienst.header.subtitle, lang)}
                </span>
            </p>
        </div>
    </Section>

    <Section variant="normal">
        <div
            class="grid gap-6 md:grid-cols-[minmax(0,2fr)_minmax(280px,1fr)] md:gap-8"
        >
            <div class="space-y-6">
                <div class="rounded-3xl border border-secondary/20 bg-white p-6 md:p-8">
                    <p class="text-text">
                        <span data-i18n={`${keyBase}.dienst.content.intro`}>
                            {localize(dienst.content.intro, lang)}
                        </span>
                    </p>
                </div>

                {
                    dienst.content.sections.map((section, sectionIndex) => (
                        <article class="rounded-3xl border border-main/30 bg-main-soft p-6 md:p-8">
                            <h2 class="text-2xl font-bold text-secondary md:text-3xl">
                                <span
                                    data-i18n={`${keyBase}.dienst.content.sections.${sectionIndex}.title`}
                                >
                                    {localize(section.title, lang)}
                                </span>
                            </h2>
                            <p class="mt-3 text-text">
                                <span
                                    data-i18n={`${keyBase}.dienst.content.sections.${sectionIndex}.body`}
                                >
                                    {localize(section.body, lang)}
                                </span>
                            </p>
                            {
                                section.bullets && section.bullets.length > 0 && (
                                    <ul class="mt-4 space-y-2">
                                        {section.bullets.map((bullet, bulletIndex) => (
                                            <li class="rounded-xl border border-secondary/15 bg-white px-4 py-2 text-text">
                                                <span
                                                    data-i18n={`${keyBase}.dienst.content.sections.${sectionIndex}.bullets.${bulletIndex}`}
                                                >
                                                    {localize(bullet, lang)}
                                                </span>
                                            </li>
                                        ))}
                                    </ul>
                                )
                            }
                        </article>
                    ))
                }
            </div>

            <div class="md:sticky md:top-24 md:self-start">
                <PricingSidebar
                    pricing={dienst.pricing}
                    lang={lang}
                    keyPrefix={`${keyBase}.dienst.pricing`}
                />
            </div>
        </div>
    </Section>

    {
        primaryCta && (
            <CTASection
                title={localize(dienst.header.title, lang)}
                text={localize(dienst.header.subtitle, lang)}
                titleKey={`${keyBase}.dienst.header.title`}
                textKey={`${keyBase}.dienst.header.subtitle`}
                primary={{
                    label: localize(primaryCta.label, lang),
                    href: primaryCta.href,
                }}
                primaryLabelKey={`${keyBase}.dienst.ctas.0.label`}
                secondary={
                    secondaryCta
                        ? {
                              label: localize(secondaryCta.label, lang),
                              href: secondaryCta.href,
                          }
                        : undefined
                }
                secondaryLabelKey={
                    secondaryCta ? `${keyBase}.dienst.ctas.1.label` : undefined
                }
            />
        )
    }
</BaseLayout>
