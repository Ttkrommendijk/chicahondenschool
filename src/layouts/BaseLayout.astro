---
import "../styles/global.css";
import Footer from "../components/Footer.astro";
import Header from "../components/Header.astro";
import FloatingWhatsAppButton from "../components/FloatingWhatsAppButton.astro";
import { resolveLangFromUrl, localize, type Lang } from "../i18n";
import { ui } from "../data/ui";

interface Props {
    title?: string;
    description?: string;
}

const { title = "ChiCa Hondenschool", description = "Beschrijving volgt." } =
    Astro.props as Props;
const lang = resolveLangFromUrl(Astro.url) as Lang;
---

<!doctype html>
<html lang={lang}>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>{title}</title>
        <meta name="description" content={description} />
        <script is:inline>
            (() => {
                const key = "lang";
                const url = new URL(window.location.href);
                const queryLang = url.searchParams.get("lang");
                const stored = window.localStorage.getItem(key);
                const valid = queryLang === "nl" || queryLang === "en";
                const storageValid = stored === "nl" || stored === "en";
                const resolved = valid
                    ? queryLang
                    : storageValid
                      ? stored
                      : "nl";

                if (!valid) {
                    url.searchParams.set("lang", resolved);
                    window.history.replaceState(null, "", url.toString());
                }

                window.localStorage.setItem(key, resolved);
                document.documentElement.lang = resolved;
                window.__lang = resolved;
            })();
        </script>
        <link
            rel="icon"
            type="image/jpeg"
            href="/images/logo-chica-hondenschool.jpg"
        />
    </head>
    <body>
        <a class="skip-link" href="#main-content"
            >{localize(ui.common.skipToContent, lang)}</a
        >
        <Header lang={lang} />
        <main id="main-content" class="section-rhythm">
            <slot />
        </main>
        <FloatingWhatsAppButton lang={lang} />
        <Footer lang={lang} />
        <script>
            import { initI18nClient } from "../i18n/client";

            initI18nClient();
        </script>
    </body>
</html>
